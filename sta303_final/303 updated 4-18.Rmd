---
title: "Gender parity Report"
subtitle:"Analysis of fairness based on talent and value in the hiring and remuneration processes"
author: "Report prepared for Black Saber Software by SFP"
date: '2021-04-21'
output:
  html_document:
    toc: yes
    toc_depth: '2'
    df_print: paged
  pdf_document:
    template: report.tex
    toc: yes
    toc_depth: 2
lang: en
subtitle: Subtitle
titlepage: yes
titlepage-color: 6C3082
titlepage-text-color: FFFFFF
titlepage-rule-color: FFFFFF
titlepage-rule-height: 2
---

```{r, message = FALSE, echo=FALSE}
library(tidyverse)
library(tidyverse)
library(lme4)
library(gtsummary)
# this should supress all code and messages
knitr::opts_chunk$set(echo = FALSE)
```

# General comments (you can delete this section)

_You can delete this section, and if you want to check what it said, just open a template from the package again. You don't have to use this particular template, but you DO need to write you report in RMarkdown and include a cover page._

_The cover page must have:_

*	_A title and subtitle_
* _"Report prepared for Black Saber Software by" your company name_
*	_Date (assessment submission date is fine)_

_You can change the colour of this cover to any colour you would like by replacing 6C3082 in the YAML above (line 11) to another hex code. You could use this tool to help you:_ https://htmlcolorcodes.com/color-picker/

\newpage
# Executive summary

_Guidelines for the executive summary:_

* _No more than two pages_
* _Language is appropriate for a non-technical audience_
* _Bullet points are used where appropriate_
*	_A small number of key visualizations and/or tables are included_
*	_All three research questions are addressed_


\newpage
# Technical report
_This part of the report is much more comprehensive than the executive summary. The audience is statistics/data-minded people, but you should NOT include code or unformatted R output here._


## Introduction

_Provide a brief introduction to your report and outline what the report will cover. This section is valuable for setting scope and expectations. _

### Research questions
* If the promotion, and salary process are all fair to all employees and based on their ability and value to BSS?
* Does the new AI service in the hiring pipeline work and is reliable for future use?
* In particular, is gender a potential bias during the promotion and salary processes?

## Informative title for section addressing a research question

_For each research question, you will want to briefly describe any data manipulation, show some exploratory plots/summary tables, report on any methods you use (i.e. models you fit) and the conclusions you draw from these_

```{r, warning=FALSE}
# This chunk provides an example of some things you can do with RMarkdown to make your report creation process easier

# read in the data
black_saber_current_employees <- read_csv("data/black-saber-current-employees.csv")
phase1 <- read_csv("data/phase1-new-grad-applicants-2020.csv")
phase2 <- read_csv("data/phase2-new-grad-applicants-2020.csv")
phase3 <- read_csv("data/phase3-new-grad-applicants-2020.csv")
final <- read_csv("data/final-hires-newgrad_2020.csv")

#join three datasets into one.
phase1_2 <- full_join(phase1,phase2)
all_phase <- left_join(phase1_2, phase3, by = "applicant_id")
final_applicant <- left_join(final, all_phase, by = "applicant_id") 

all_phase$final_result <- ifelse(all_phase$applicant_id %in% final_applicant$applicant_id, "Hired",          
                           ifelse(all_phase$applicant_id %in% phase3$applicant_id,"Refused at phase 3",  
                           ifelse(all_phase$applicant_id %in% phase2$applicant_id,"Refused at phase 2","Refused at phase 1")))
all_phase$final_result <- factor(all_phase$final_result,level=c("Refused at phase 1","Refused at phase 2","Refused at phase 3","Hired"))


# create new variables to show the hiring results for each candidates in each phrase
phase1$result <- ifelse(phase1$applicant_id %in% phase2$applicant_id,"proceed","refused")
phase2$result <- ifelse(phase2$applicant_id %in% phase3$applicant_id,"proceed","refused")
phase3$result <- ifelse(phase3$applicant_id %in% final$applicant_id,"proceed","refused")
all_phase$result <- ifelse(all_phase$applicant_id %in% final$applicant_id,"Hired","no")

# Create model 1 to see if several response variables are related to the final result.

model_1 <- glm(as.factor(result) ~ gpa+cv+cover_letter+extracurriculars+work_experience,
               data = all_phase, family = binomial("logit"))

tbl_regression(model_1)

#Create model 2 to see AI score preference
```
model_1
```{r}
model_2 <- glm(as.factor(result) ~ gpa+extracurriculars+work_experience+leadership_presence+
                 speaking_skills+technical_skills+writing_skills, 
               data = phase2, family = binomial("logit"))

tbl_regression(model_2)

```
model_2
```{r}
## gender, promotion, and salary

# clean the salary data for further analysis
black_saber_current_employees$salary<-gsub("\\$","",black_saber_current_employees$salary)
black_saber_current_employees$salary<-gsub("\\,","",black_saber_current_employees$salary)
black_saber_current_employees$salary<-as.numeric(black_saber_current_employees$salary)

# change the data types
black_saber_current_employees$employee_id<-as.character(black_saber_current_employees$employee_id)
black_saber_current_employees$gender<-as.factor(black_saber_current_employees$gender)
black_saber_current_employees$team<-as.factor(black_saber_current_employees$team)
black_saber_current_employees$role_seniority<-as.factor(black_saber_current_employees$role_seniority)
black_saber_current_employees$leadership_for_level<-as.factor(black_saber_current_employees$leadership_for_level)

# check general relationship between productivity and salary for each team
black_saber_current_employees %>% 
 ggplot(aes(x= productivity,y=salary,color=gender))+
  geom_smooth(method = "lm",
              se = FALSE,
              size = 1.5) +
  facet_wrap(~team) +
  theme_minimal()+
  labs(title="Productivity by salary",
       x="Productivity",
       y="Salary",
       caption = str_c("Prepared by SFP\n",Sys.Date()))
ggsave("images/productivity_salary.png",width = 7, height = 4)

#models to check if salary is related to other variables
mod_1 <-lmer(salary~gender+team+(1|employee_id),
             data=black_saber_current_employees)
summary(mod_1)
mod_2 <-lmer(salary~gender+team+role_seniority+productivity+leadership_for_level+(1|employee_id:team)+(1|employee_id),data=black_saber_current_employees)
lmtest::lrtest(mod_1,mod_2)


#check general relationship between productivity and leadership_for_level for each team
black_saber_current_employees %>% 
 ggplot(aes(x= leadership_for_level,fill=gender))+
  geom_bar(position="fill")+
  theme_minimal()+
  facet_wrap(~team)+
  labs(title="Gender distribution on leadership for level",
       x="Leadership for level",
       y="Percentage",
       caption = str_c("Prepared by SFP\n",Sys.Date())) +
  scale_x_discrete(guide = guide_axis(n.dodge = 3))
  ggsave("images/productivity_leadership.png",width = 7, height = 4)
```






## Informative title for section addressing a research question
## Informative title for section addressing a research question

```{r, include = FALSE}

```

## Discussion

_In this section you will summarize your findings across all the research questions and discuss the strengths and limitations of your work. It doesn't have to be long, but keep in mind that often people will just skim the intro and the discussion of a document like this, so make sure it is useful as a semi-standalone section (doesn't have to be completely standalone like the executive summary)._

### Strengths and limitations

\newpage
# Consultant information
## Consultant profiles

**Lucas Xian**. Lucas is a senior consultant with SFP. He specializes in data analysis and visualization. Lucas earned his Honours Bachelor of Science, Specialist in Statistics, from the University of Toronto in 2023.

**Dandan Zhang**. Dandan is a junior consultant with SFP. She earned her Bachelor of Science, majoring in Mathematics and Statistics, from the University of Toronto in 2021.She specializes in data visualization. 

**Jong-Hoon Kim** John is a senior consultant with SFP. He earned his Bachelor of Science in statistics and economics, from the University of Toronto in 2021. He specialises in data analysis and visualisation. 

**Zikun Lei** Zikun Lei is a senior consultant with SFP. He earned his Bachelor of Science in statistics and economics, from the University of Toronto in 2021. He specialises in data analysis and visualisation. 


## Code of ethical conduct

_This section should be fairly short, no more than half a page. Assume a general audience, much like your executive summary._

* _Make at least three relevant statements about your company’s approach to ethical statistical consulting. These should be appropriately in line with professional conduct advice like the (Statistical Society of Canada Code of Conduct)[https://ssc.ca/sites/default/files/data/Members/public/Accreditation/ethics_e.pdf] or the (Ethical Guidelines for Statistical Practice from the American Statistical Society)[https://www.amstat.org/ASA/Your-Career/Ethical-Guidelines-for-Statistical-Practice.aspx]. For example, "the customer is always right" ISN’T the type of thing an ethical statistical consultant would include._
*	_Be very careful not to just copy and paste from these other documents! Put things in your own words._


__Final advice: KNIT EARLY AND OFTEN!__
